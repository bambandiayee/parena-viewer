<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Parena Design - Viewer</title>
  <style>
    :root {
      --color-primary: #18a0fb;
      --color-secondary: #f5f5f5;
      --color-text: #333;
      --color-bg: #fff;
      --color-gray: #e2e2e2;
      --color-gray-dark: #888;
      --sidebar-width: 280px;
      --header-height: 60px;
    }

    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      font-family: Inter, -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
      color: var(--color-text);
      background-color: var(--color-bg);
      display: flex;
      flex-direction: column;
      height: 100vh;
    }

    header {
      height: var(--header-height);
      border-bottom: 1px solid var(--color-gray);
      display: flex;
      align-items: center;
      padding: 0 20px;
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      background-color: var(--color-bg);
      z-index: 10;
    }

    .logo {
      font-weight: bold;
      font-size: 20px;
      color: var(--color-primary);
    }

    .project-title {
      margin-left: 40px;
      font-weight: 600;
    }

    .main-container {
      display: flex;
      height: calc(100vh - var(--header-height));
      margin-top: var(--header-height);
    }

    .sidebar {
      width: var(--sidebar-width);
      border-right: 1px solid var(--color-gray);
      height: 100%;
      overflow-y: auto;
      padding: 20px;
    }

    .frames-list {
      list-style: none;
    }

    .frame-item {
      padding: 12px 15px;
      border-radius: 6px;
      margin-bottom: 8px;
      cursor: pointer;
      transition: background-color 0.2s;
    }

    .frame-item:hover {
      background-color: var(--color-secondary);
    }

    .frame-item.active {
      background-color: var(--color-primary);
      color: white;
    }

    .content {
      flex: 1;
      height: 100%;
      display: flex;
      overflow: hidden;
    }

    .canvas {
      flex: 1;
      overflow: auto;
      padding: 40px;
      display: flex;
      justify-content: center;
      align-items: flex-start;
      background-color: #f0f0f0;
    }

    .frame-preview {
      box-shadow: 0 4px 30px rgba(0, 0, 0, 0.1);
      background-color: white;
      position: relative;
    }

    .frame-preview img {
      display: block;
      max-width: 100%;
    }

    .specs-panel {
      width: 320px;
      border-left: 1px solid var(--color-gray);
      height: 100%;
      overflow-y: auto;
      background-color: white;
      padding: 20px;
    }

    .specs-header {
      margin-bottom: 20px;
      padding-bottom: 15px;
      border-bottom: 1px solid var(--color-gray);
    }

    .specs-section {
      margin-bottom: 25px;
    }

    .specs-section h3 {
      font-size: 14px;
      color: var(--color-gray-dark);
      margin-bottom: 10px;
      text-transform: uppercase;
    }

    .specs-item {
      display: flex;
      justify-content: space-between;
      padding: 8px 0;
      border-bottom: 1px solid var(--color-gray);
    }

    .specs-item:last-child {
      border-bottom: none;
    }

    .color-preview {
      width: 20px;
      height: 20px;
      border-radius: 4px;
      display: inline-block;
      vertical-align: middle;
      margin-right: 10px;
      border: 1px solid var(--color-gray);
    }

    .element-list {
      list-style: none;
      margin-top: 15px;
    }

    .element-item {
      padding: 8px;
      border-radius: 4px;
      margin-bottom: 5px;
      background-color: var(--color-secondary);
      cursor: pointer;
    }

    .element-item:hover {
      background-color: #e8e8e8;
    }

    .element-item.selected {
      background-color: #e9f5fe;
      border: 1px solid var(--color-primary);
    }

    .copy-button {
      background-color: var(--color-primary);
      color: white;
      border: none;
      border-radius: 4px;
      padding: 5px 10px;
      font-size: 12px;
      cursor: pointer;
      margin-top: 5px;
    }

    .copy-button:hover {
      opacity: 0.9;
    }

    /* Éléments sélectionnables sur la frame */
    .selectable-element {
      position: absolute;
      border: 1px solid transparent;
      pointer-events: all;
      cursor: pointer;
    }

    .selectable-element:hover {
      border: 1px solid rgba(24, 160, 251, 0.5);
    }

    .selectable-element.selected {
      border: 1px solid var(--color-primary);
    }

    /* Code block */
    .code-block {
      background-color: #f8f8f8;
      border-radius: 4px;
      padding: 10px;
      margin-top: 10px;
      font-family: 'Courier New', Courier, monospace;
      font-size: 12px;
      white-space: pre-wrap;
      margin-bottom: 10px;
    }

    /* Loading state */
    .loading {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      height: 100%;
    }

    .spinner {
      border: 3px solid #f3f3f3;
      border-top: 3px solid #18a0fb;
      border-radius: 50%;
      width: 30px;
      height: 30px;
      animation: spin 1s linear infinite;
      margin-bottom: 20px;
    }

    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

    /* Error state */
    .error-container {
      text-align: center;
      max-width: 600px;
      margin: 0 auto;
      padding: 40px;
    }

    .error-container h2 {
      color: #ff3b30;
      margin-bottom: 20px;
    }

    .error-container p {
      margin-bottom: 20px;
      line-height: 1.6;
    }

    /* Responsive */
    @media (max-width: 1024px) {
      .specs-panel {
        width: 280px;
      }
    }

    @media (max-width: 768px) {
      .main-container {
        flex-direction: column;
      }

      .sidebar {
        width: 100%;
        height: auto;
        max-height: 200px;
        border-right: none;
        border-bottom: 1px solid var(--color-gray);
      }

      .specs-panel {
        width: 100%;
        height: auto;
        max-height: 40%;
        border-left: none;
        border-top: 1px solid var(--color-gray);
      }

      .content {
        flex-direction: column;
      }
    }
  </style>
</head>
<body>
  <header>
    <div class="logo">Parena Design</div>
    <div class="project-title" id="project-title">Chargement du projet...</div>
  </header>

  <div class="main-container" id="main-container">
    <!-- État de chargement initial -->
    <div class="loading" id="loading">
      <div class="spinner"></div>
      <div>Chargement du projet...</div>
    </div>

    <!-- Affichage d'erreur -->
    <div class="error-container" id="error-container" style="display: none;">
      <h2>Impossible de charger le projet</h2>
      <p id="error-message">Une erreur est survenue lors du chargement du projet.</p>
      <p>Vérifiez que l'URL est correcte et que le projet existe.</p>
    </div>

    <!-- Contenu principal (affiché après le chargement) -->
    <div id="project-content" style="display: none; width: 100%; height: 100%;">
      <aside class="sidebar">
        <h2>Frames</h2>
        <ul class="frames-list" id="frames-list">
          <!-- Les frames seront ajoutées ici dynamiquement -->
        </ul>
      </aside>

      <main class="content">
        <div class="canvas" id="canvas">
          <div class="frame-preview" id="frame-preview">
            <!-- L'image de la frame sera ajoutée ici -->
          </div>
        </div>

        <div class="specs-panel" id="specs-panel">
          <div class="specs-header">
            <h2 id="element-name">Aucun élément sélectionné</h2>
          </div>

          <div class="specs-section">
            <h3>Dimensions</h3>
            <div class="specs-item">
              <span>Largeur</span>
              <span id="element-width">-</span>
            </div>
            <div class="specs-item">
              <span>Hauteur</span>
              <span id="element-height">-</span>
            </div>
            <div class="specs-item">
              <span>Position X</span>
              <span id="element-x">-</span>
            </div>
            <div class="specs-item">
              <span>Position Y</span>
              <span id="element-y">-</span>
            </div>
          </div>

          <div class="specs-section" id="element-colors-section">
            <h3>Couleurs</h3>
            <div class="specs-item">
              <span>
                <span class="color-preview" id="element-color-preview" style="background-color: white;"></span>
                Couleur
              </span>
              <span id="element-color">-</span>
            </div>
            <div class="specs-item">
              <span>Opacité</span>
              <span id="element-opacity">-</span>
            </div>
          </div>

          <div class="specs-section" id="text-properties-section" style="display: none;">
            <h3>Texte</h3>
            <div class="specs-item">
              <span>Police</span>
              <span id="element-font">-</span>
            </div>
            <div class="specs-item">
              <span>Taille</span>
              <span id="element-font-size">-</span>
            </div>
            <div class="specs-item">
              <span>Graisse</span>
              <span id="element-font-weight">-</span>
            </div>
          </div>

          <div class="specs-section">
            <h3>Code CSS</h3>
            <div class="code-block" id="css-code">Sélectionnez un élément pour voir le code</div>
            <button class="copy-button" id="copy-css-button">Copier le CSS</button>
          </div>
        </div>
      </main>
    </div>
  </div>

  <script>
    // Éléments DOM
    const projectTitle = document.getElementById('project-title');
    const loadingElement = document.getElementById('loading');
    const errorContainer = document.getElementById('error-container');
    const errorMessage = document.getElementById('error-message');
    const projectContent = document.getElementById('project-content');
    const framesList = document.getElementById('frames-list');
    const framePreview = document.getElementById('frame-preview');
    const canvas = document.getElementById('canvas');
    const specsPanel = document.getElementById('specs-panel');
    const elementName = document.getElementById('element-name');
    const elementWidth = document.getElementById('element-width');
    const elementHeight = document.getElementById('element-height');
    const elementX = document.getElementById('element-x');
    const elementY = document.getElementById('element-y');
    const elementColorPreview = document.getElementById('element-color-preview');
    const elementColor = document.getElementById('element-color');
    const elementOpacity = document.getElementById('element-opacity');
    const elementFont = document.getElementById('element-font');
    const elementFontSize = document.getElementById('element-font-size');
    const elementFontWeight = document.getElementById('element-font-weight');
    const textPropertiesSection = document.getElementById('text-properties-section');
    const cssCode = document.getElementById('css-code');
    const copyCssButton = document.getElementById('copy-css-button');

    // Variables globales
    let currentProject = null;
    let currentFrame = null;
    let currentElement = null;
    let elementsMap = {};

    // Démarrage
    document.addEventListener('DOMContentLoaded', () => {
      loadProjectFromUrl();
    });

    // Fonction pour charger le projet depuis l'URL ou le localStorage
    async function loadProjectFromUrl() {
      try {
        // Récupérer l'ID du projet depuis l'URL
        const urlParams = new URLSearchParams(window.location.search);
        const projectId = urlParams.get('projectId');
        
        if (!projectId) {
          throw new Error('Aucun ID de projet spécifié');
        }
        
        // Dans une version réelle, vous feriez une requête au serveur
        // Pour cette démo, nous utilisons le localStorage
        const projectJson = localStorage.getItem(`parena_project_${projectId}`);
        
        if (!projectJson) {
          throw new Error('Projet non trouvé');
        }
        
        // Charger le projet
        currentProject = JSON.parse(projectJson);
        
        // Mettre à jour l'interface
        projectTitle.textContent = currentProject.name;
        
        // Initialiser l'interface du projet
        renderFramesList();
        
        // Masquer le chargement et afficher le contenu
        loadingElement.style.display = 'none';
        projectContent.style.display = 'flex';
        
      } catch (error) {
        console.error('Erreur lors du chargement du projet:', error);
        
        // Afficher l'erreur
        loadingElement.style.display = 'none';
        errorContainer.style.display = 'block';
        errorMessage.textContent = error.message || 'Une erreur est survenue lors du chargement du projet.';
      }
    }

    // Fonction pour générer la liste des frames
    function renderFramesList() {
      framesList.innerHTML = '';
      
      if (!currentProject || !currentProject.frames || currentProject.frames.length === 0) {
        const li = document.createElement('li');
        li.textContent = 'Aucune frame disponible';
        framesList.appendChild(li);
        return;
      }
      
      currentProject.frames.forEach((frame, index) => {
        const li = document.createElement('li');
        li.className = 'frame-item';
        li.textContent = frame.name;
        li.dataset.frameIndex = index.toString();
        
        li.addEventListener('click', () => {
          document.querySelectorAll('.frame-item').forEach(item => {
            item.classList.remove('active');
          });
          li.classList.add('active');
          loadFrame(frame);
        });
        
        framesList.appendChild(li);
      });
      
      // Charger la première frame par défaut
      if (currentProject.frames.length > 0) {
        framesList.querySelector('.frame-item').classList.add('active');
        loadFrame(currentProject.frames[0]);
      }
    }

    // Fonction pour charger une frame
    function loadFrame(frame) {
      currentFrame = frame;
      elementsMap = {};
      
      // Définir les dimensions de la frame
      framePreview.style.width = `${frame.width}px`;
      framePreview.style.height = `${frame.height}px`;
      
      // Charger l'image
      framePreview.innerHTML = `<img src="data:image/png;base64,${frame.imageBase64}" alt="${frame.name}" width="${frame.width}" height="${frame.height}">`;
      
      // Ajouter les éléments sélectionnables
      frame.elements.forEach(element => {
        const div = document.createElement('div');
        div.className = 'selectable-element';
        div.dataset.elementId = element.id;
        div.style.left = `${element.x}px`;
        div.style.top = `${element.y}px`;
        div.style.width = `${element.width}px`;
        div.style.height = `${element.height}px`;
        
        div.addEventListener('click', (e) => {
          e.stopPropagation();
          selectElement(element);
        });
        
        framePreview.appendChild(div);
        elementsMap[element.id] = element;
      });
      
      // Réinitialiser la sélection
      currentElement = null;
      updateElementSpecs(null);
      
      // Centrer la frame dans le canvas
      centerFrameInCanvas();
    }

    // Fonction pour centrer la frame dans le canvas
    function centerFrameInCanvas() {
      if (!currentFrame) return;
      
      const canvasWidth = canvas.clientWidth;
      const canvasHeight = canvas.clientHeight;
      const frameWidth = currentFrame.width;
      const frameHeight = currentFrame.height;
      
      // Calculer le zoom pour adapter la frame à la vue, si nécessaire
      const scale = Math.min(1, (canvasHeight - 80) / frameHeight, (canvasWidth - 80) / frameWidth);
      
      // Appliquer le zoom seulement si la frame est trop grande
      if (scale < 1) {
        framePreview.style.transform = `scale(${scale})`;
        framePreview.style.transformOrigin = 'top left';
      } else {
        framePreview.style.transform = '';
      }
    }

    // Fonction pour sélectionner un élément
    function selectElement(element) {
      currentElement = element;
      
      // Mettre à jour l'apparence des éléments
      document.querySelectorAll('.selectable-element').forEach(el => {
        el.classList.remove('selected');
      });
      
      if (element) {
        document.querySelector(`.selectable-element[data-element-id="${element.id}"]`).classList.add('selected');
      }
      
      updateElementSpecs(element);
    }

    // Fonction pour mettre à jour les specs d'un élément
    function updateElementSpecs(element) {
      if (!element) {
        elementName.textContent = 'Aucun élément sélectionné';
        elementWidth.textContent = '-';
        elementHeight.textContent = '-';
        elementX.textContent = '-';
        elementY.textContent = '-';
        elementColor.textContent = '-';
        elementColorPreview.style.backgroundColor = 'white';
        elementOpacity.textContent = '-';
        textPropertiesSection.style.display = 'none';
        cssCode.textContent = 'Sélectionnez un élément pour voir le code';
        return;
      }
      
      // Informations de base
      elementName.textContent = element.name;
      elementWidth.textContent = `${element.width}px`;
      elementHeight.textContent = `${element.height}px`;
      elementX.textContent = `${element.x}px`;
      elementY.textContent = `${element.y}px`;
      
      // Couleurs
      elementColor.textContent = element.color || '-';
      elementColorPreview.style.backgroundColor = element.color || 'transparent';
      elementOpacity.textContent = element.opacity !== undefined ? element.opacity.toString() : '-';
      
      // Propriétés de texte
      if (element.type === 'TEXT') {
        textPropertiesSection.style.display = 'block';
        elementFont.textContent = element.fontFamily || '-';
        elementFontSize.textContent = element.fontSize ? `${element.fontSize}px` : '-';
        elementFontWeight.textContent = element.fontWeight || '-';
      } else {
        textPropertiesSection.style.display = 'none';
      }
      
      // Générer le code CSS
      generateCssCode(element);
    }

    // Fonction pour générer le code CSS
    function generateCssCode(element) {
      let css = `.${element.name.toLowerCase().replace(/\s+/g, '-')} {\n`;
      css += `  width: ${element.width}px;\n`;
      css += `  height: ${element.height}px;\n`;
      
      if (element.color) {
        css += `  background-color: ${element.color};\n`;
      }
      
      if (element.opacity !== undefined && element.opacity < 1) {
        css += `  opacity: ${element.opacity};\n`;
      }
      
      if (element.type === 'TEXT') {
        if (element.fontFamily) {
          css += `  font-family: ${element.fontFamily};\n`;
        }
        if (element.fontSize) {
          css += `  font-size: ${element.fontSize}px;\n`;
        }
        if (element.fontWeight) {
          css += `  font-weight: ${element.fontWeight};\n`;
        }
      }
      
      css += `}`;
      
      cssCode.textContent = css;
    }

    // Fonction pour copier le CSS
    copyCssButton.addEventListener('click', () => {
      if (!currentElement) return;
      
      navigator.clipboard.writeText(cssCode.textContent)
        .then(() => {
          const originalText = copyCssButton.textContent;
          copyCssButton.textContent = 'Copié!';
          setTimeout(() => {
            copyCssButton.textContent = originalText;
          }, 2000);
        })
        .catch(err => {
          console.error('Erreur lors de la copie: ', err);
        });
    });

    // Gestion du redimensionnement de la fenêtre
    window.addEventListener('resize', centerFrameInCanvas);
  </script>
</body>
</html>
